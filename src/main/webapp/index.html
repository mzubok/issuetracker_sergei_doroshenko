<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<title>Issue Tracker</title>
		 
		<link rel="stylesheet" type="text/css" media="screen" href="css/ui-lightness/jquery-ui.css" />
		<link rel="stylesheet" type="text/css" media="screen" href="css/ui.jqgrid.css" />
		<link rel="stylesheet" type="text/css" media="screen" href="css/default.css" />
		
		<script type="text/javascript" src="js/jquery-1.9.0.min.js"> </script>
		<script type="text/javascript" src="js/i18n/grid.locale-en.js"> </script>
		<script type="text/javascript" src="js/jquery.jqGrid.min.js"> </script>
		<script type="text/javascript" src="js/jquery.form.js"> </script>
		<!-- script type="text/javascript" src="js/table.js"> </script-->
		<script type="text/javascript">
			$(document).ready(function(){
				
				var options = {
					cache: false,
					target: "#authform",
                    url: "Login.do",
                    type: "POST",
					beforeSubmit: showRequest,
					success: showResponse,
					timeout: 3000,
                    clearForm: true,
                    resetForm: true,
                    complete: function(xhr, statusText) {
                        //alert(xhr.statusText);
                    },
                    error: handleError
				};

				$("#authform").submit(function() {
					$('#password').css('border','none');
					$('#login').css('border','none');
					$(this).ajaxSubmit(options);
					return false;
				});
			 });
             
				function showRequest(formData, jqForm, options) {
					var queryString = $.param(formData);
					alert('We send this: \n\n' + queryString);
					return true;
				}
				
				function showResponse(responseText, statusText) {
					//alert('Server response status: ' + statusText +
					//'\n\nServer response text: \n' + responseText +
					//'\n\nwill placed in element #user-info.');
					
					$("#authform:first").css("color", "white");
					$('#error').empty();
					$('<a>',{
					    text:'log out',
					    href:'Login.do',
					    class: 'logout'
					    //click:function(){alert('test');return true;}
					}).appendTo("#authform");
				}
				
				function handleError (response, status, err) {
			        // This option doesn't catch any of the error below, 
			        // everything is always 'OK' a.k.a 200
			        if(response.status == 400){
			        	var errText = response.responseText;
			        	var errKey = errText.substring(0,1);
			        	
			        	if (errKey == 'p') {
			        		$('#password').css('border','2px solid red');
			        	} else if (errKey == 'e') {
			        		$('#login').css('border','2px solid red');
			        	} else {
			        		$('#password').css('border','2px solid red');
			        		$('#login').css('border','2px solid red');
			        	}
			            //console.log("Sorry, this is bad request!");
			            //alert(response.responseText + '!!' + err + '!! ' + status);
			            $('#error').empty().append(errText);
			            
			        }
			        if(response.status == 601){
			            sessionTimedOut();
			        }
			    }
				
			
		</script>
	</head>
	<body>
		<div class="page-wrapper">
			<div class="header">
				<div class="logo">
					<h2>Issue Tracker</h2>
				</div><!--end logo-->
				<div id="user-info" class="user-info">
					<div id="error"></div>
                    <form id="authform">
                        <label>Name:</label>
                        <input name="login" id="login" class="login" type="text" value="My name"/>
                        <label>Password:</label>
                        <input name="password" id="password" class="password" type="password" />
                        <input id="authsubmit" class="authsubmit" type="submit" value="Log in" />
                    </form>
				</div><!--end user-info-->
			</div><!--end header-->
			<div id="menu-bar" class="menu-bar">
			</div>
			<div class="content">
				<div class="table-container">
					<!-- table id="list"><tr><td></td></tr></table--> 
					<!-- div id="pager"></div-->
				</div><!--end issue-table-->
			</div><!--end content-->
			<div class="footer">
				<span>Copyright &copy Sergei Doroshenko</span>
			</div><!--end footer-->
		</div><!--end page-wrapper-->
		
		
	</body>
</html>